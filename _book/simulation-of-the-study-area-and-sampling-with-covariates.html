<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 6 Simulation of the study area and sampling WITH covariates | mashup: N-mixture models</title>
  <meta name="description" content="derived from the bookdown minimal example. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.22.17 and GitBook 2.6.7" />

  <meta property="og:title" content=" 6 Simulation of the study area and sampling WITH covariates | mashup: N-mixture models" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="derived from the bookdown minimal example. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 6 Simulation of the study area and sampling WITH covariates | mashup: N-mixture models" />
  
  <meta name="twitter:description" content="derived from the bookdown minimal example. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Cord Phelps" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="unmarked.html"/>
<link rel="next" href="ref.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">a label in _output.yml</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> <span>https://stackoverflow.com/questions/51424537/whats-the-difference-between-bookdown-yml-output-yml-and-yaml-header-of</span></a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="gen.html"><a href="gen.html"><i class="fa fa-check"></i><b>3</b> N mixture models: In General</a></li>
<li class="chapter" data-level="4" data-path="simWithout.html"><a href="simWithout.html"><i class="fa fa-check"></i><b>4</b> Simulation of a population and a sampling WITHOUT covariates</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simWithout.html"><a href="simWithout.html#the-poisson-distribution"><i class="fa fa-check"></i><b>4.1</b> the Poisson distribution</a></li>
<li class="chapter" data-level="4.2" data-path="simWithout.html"><a href="simWithout.html#distribute-a-simulated-deer-population"><i class="fa fa-check"></i><b>4.2</b> distribute a simulated deer population</a></li>
<li class="chapter" data-level="4.3" data-path="simWithout.html"><a href="simWithout.html#sampling-simulation"><i class="fa fa-check"></i><b>4.3</b> Sampling Simulation</a></li>
<li class="chapter" data-level="4.4" data-path="simWithout.html"><a href="simWithout.html#sampled-cells"><i class="fa fa-check"></i><b>4.4</b> Sampled Cells</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="unmarked.html"><a href="unmarked.html"><i class="fa fa-check"></i><b>5</b> The simplest N-mixture model with unmarked</a></li>
<li class="chapter" data-level="6" data-path="simulation-of-the-study-area-and-sampling-with-covariates.html"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html"><i class="fa fa-check"></i><b>6</b> Simulation of the study area and sampling WITH covariates</a></li>
<li class="chapter" data-level="7" data-path="ref.html"><a href="ref.html"><i class="fa fa-check"></i><b>7</b> references</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">mashup: N-mixture models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulation-of-the-study-area-and-sampling-with-covariates" class="section level1" number="6">
<h1><span class="header-section-number"> 6</span> Simulation of the study area and sampling WITH covariates</h1>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>Supongamos ahora que nuestra población de ciervos virtuales se distribuye en un paisaje como el de la siguiente imagen</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>Now suppose that our population of virtual deer is distributed in a landscape like the one in the following image</p>
</div>
</div>
<p><br /></p>
<p><img src="images/aerial.png" title="Javier Fernández-López" alt="alt text" />
Javier Fernández-López</p>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>Como vemos, hay un punto de agua en la parte inferior izquierda. Vamos a crear una capa raster que indique la distancia al punto de agua, la cual usaremos posteriormente como covariable predictora para distribuir nuestros ciervos.</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>As we can see, there is a water point in the lower left. We are going to create a raster layer that indicates the distance to the water point, which we will later use as a predictor covariate to distribute our deer.</p>
</div>
</div>
<p><br /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nótese que estamos estandarizando las distancias con scale(). </span></span>
<span id="cb33-2"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Para no obtener distancias negativas, le sumaremos 2.28668</span></span>
<span id="cb33-3"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (Note that we are standardizing the distances with scale ().</span></span>
<span id="cb33-5"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In order not to obtain negative distances, we will add 2.28668)</span></span>
<span id="cb33-6"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-7" aria-hidden="true" tabindex="-1"></a>dwat.rasterLayer <span class="ot">&lt;-</span> </span>
<span id="cb33-8"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">scale</span>(raster<span class="sc">::</span><span class="fu">distanceFromPoints</span>(sarea, <span class="fu">c</span>(<span class="fl">3.5</span>,<span class="fl">3.5</span>))) <span class="sc">+</span> <span class="fl">2.28668</span></span>
<span id="cb33-9"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the raster to a dataframe for use by ggplot()</span></span>
<span id="cb33-11"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb33-11" aria-hidden="true" tabindex="-1"></a>gg.raster.df <span class="ot">&lt;-</span> cartomisc<span class="sc">::</span><span class="fu">gplot_data</span>(dwat.rasterLayer)</span></code></pre></div>
<p><br /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dwat.rasterLayer)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-2"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(gg.raster.df, <span class="sc">!</span><span class="fu">is.na</span>(value)), </span>
<span id="cb35-3"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb35-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill=</span>value)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>color.vector) <span class="sc">+</span></span>
<span id="cb35-5"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()  <span class="sc">+</span></span>
<span id="cb35-6"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">y =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="width:45%">
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
</div>
</div>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>En el ejemplo anterior, habíamos distribuido los ciervos aleatoriamente siguiendo una distribución de Poisson con λ=4 para todo el territorio (Eq 2).</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>In the previous example, we had randomly distributed the deer following a Poisson distribution with λ = 4 for the entire territory (Eq 2).</p>
</div>
</div>
<p><br /></p>
<p><span class="math display">\[ N_{i} \sim Poisson(λ) \]</span>
<br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>Sin embargo, ahora queremos que nuestros ciervos se distribuyan conforme a la distancia al punto de agua, de tal forma que haya más ciervos cerca del agua, y su abundancia disminuya conforme nos vamos alejando de ella (estamos en una zona árida y durante la época estival el agua escasea, actuando como un atractor de ciervos). Eso quiere decir que λ (abundancia promedio) debe ser alta en aquellas celdas con valores bajos de distancia al agua dwat, e irá disminuyendo con forme aumente dwat. Este comportamiento se puede expresar como</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>However, now we want our deer to be distributed according to the distance to the water point, in such a way that there are more deer near the water, and their abundance decreases as we move away from it (we are in an arid area and during the summer water is scarce, acting as a deer attractor). This means that λ (average abundance) must be high in those cells with low values of distance to water dwat, and it will decrease as dwat increases. This behavior can be expressed as</p>
</div>
</div>
<p><br /></p>
<p><span class="math display">\[ log(λ) = \beta_{0} + \beta_{1} *  dwat_{i}  \]</span></p>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>donde λi es la abundancia promedio en la celda i, β0 es el intercepto del modelo lineal que predice la abundancia, β1 es la “fuerza” del efecto de la distancia al agua sobre la abundancia de ciervos (la fuerza con la que el agua atrae o repele a los ciervos), y dwati es la distancia al punto de agua desde la celda i. Así, podemos intuir que la λ de cada celda dependerá de la variable “distancia al agua.” Por lo tanto, la ecuación general que gobernará la distribución de nuestros ciervos ahora sera:</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>where λi is the average abundance in cell i, β0 is the intercept of the linear model predicting abundance, β1 is the “force” of the effect of distance to water on deer abundance (the force with which the water attracts or repels deer), and dwati is the distance to the water point from cell i. Thus, we can guess that the λ of each cell will depend on the variable “distance to water.” Therefore, the general equation that will govern the distribution of our deer will now be:</p>
</div>
</div>
<p><br /></p>
<p><span class="math display">\[ N \sim Poisson(exp(\beta_{0} + \beta_{1} *  dwat_{i}))  \]</span></p>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>Para que se cumpla nuestra premisa de que haya menos ciervos cuanto más nos alejemos del punto de agua, al coeficiente β1 deberemos darle un valor negativo (el agua atrae a los ciervos). Estos serán nuestros valores:</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>In order to fulfill our premise that there are fewer deer the further we move from the water point, we must give the coefficient β1 a negative value (water attracts deer). These will be our values:</p>
</div>
</div>
<p><br /></p>
<p>$<em>{0} = 3 $
$</em>{1} = -0.9 $</p>
<p><br /></p>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>Calculamos la λ para cada celda siguiendo nuestra fórmula y los valores elegidos para los coeficientes:</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>We calculate the λ for each cell following our formula and the values chosen for the coefficients:</p>
</div>
</div>
<p><br /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb36-1" aria-hidden="true" tabindex="-1"></a>beta_0 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb36-2"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb36-2" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.9</span></span>
<span id="cb36-3"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb36-4" aria-hidden="true" tabindex="-1"></a>lambda.rasterLayer <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta_0 <span class="sc">+</span> beta_1<span class="sc">*</span>(dwat.rasterLayer))</span>
<span id="cb36-5"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the raster to a dataframe for use by ggplot()</span></span>
<span id="cb36-7"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb36-7" aria-hidden="true" tabindex="-1"></a>gg.raster.df <span class="ot">&lt;-</span> cartomisc<span class="sc">::</span><span class="fu">gplot_data</span>(lambda.rasterLayer)</span></code></pre></div>
<p><br /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lambda.rasterLayer)</span></code></pre></div>
<p><br /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-2"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(gg.raster.df, <span class="sc">!</span><span class="fu">is.na</span>(value)), </span>
<span id="cb38-3"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb38-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill=</span>value)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>color.vector) <span class="sc">+</span></span>
<span id="cb38-5"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()  <span class="sc">+</span></span>
<span id="cb38-6"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">y =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="width:45%">
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
</div>
</div>
<p><br /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un raster de 10x10 celdas vacías</span></span>
<span id="cb39-2"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-2" aria-hidden="true" tabindex="-1"></a>sareaNew <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(<span class="at">nrows =</span> <span class="dv">10</span>, <span class="at">ncols =</span> <span class="dv">10</span>, <span class="at">xmn =</span> <span class="dv">0</span>, <span class="at">xmx =</span> <span class="dv">10</span>, <span class="at">ymn =</span> <span class="dv">0</span>, <span class="at">ymx =</span> <span class="dv">10</span>)  <span class="co"># study area</span></span>
<span id="cb39-3"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># not sure why we need to re-create sarea.....</span></span>
<span id="cb39-5"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos un bucle para rellenar cada celda con el número de ciervos correspondiente según</span></span>
<span id="cb39-7"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># el lambda de cada celda</span></span>
<span id="cb39-8"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>raster<span class="sc">::</span><span class="fu">ncell</span>(sareaNew)){</span>
<span id="cb39-9"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  sareaNew[i] <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda.rasterLayer[i])</span>
<span id="cb39-10"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-11"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the raster to a dataframe for use by ggplot()</span></span>
<span id="cb39-14"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb39-14" aria-hidden="true" tabindex="-1"></a>gg.raster.df <span class="ot">&lt;-</span> cartomisc<span class="sc">::</span><span class="fu">gplot_data</span>(sareaNew)</span></code></pre></div>
<p><br /></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sareaNew)</span></code></pre></div>
<p><br /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/47116217/</span></span>
<span id="cb41-2"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># overlay-raster-layer-on-map-in-ggplot2-in-r</span></span>
<span id="cb41-3"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-5"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data =</span> gg.raster.df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill=</span>value)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>color.vector) <span class="sc">+</span></span>
<span id="cb41-7"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()  <span class="sc">+</span></span>
<span id="cb41-8"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">y =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="width:45%">
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
</div>
</div>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>Ya tenemos nuestros ciervos distribuidos. Recapitulando, esta población también se distribuye siguiendo una distribución de Poisson. La diferencia con respecto al ejemplo anterior es que ahora el parámentro λ de esa distribución no es homogéneo para todo el área de estudio, sino que varía con respecto a una covariable o variable predictora, la distancia a un punto de agua en nuestro caso. Esta situación es mucho más realista que la anterior. Podemos ver cual es el número total de individuos de nuestra población, N.</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>We already have our deer distributed. Recapitulating, this population is also distributed following a Poisson distribution. The difference with respect to the previous example is that now the parameter λ of this distribution is not homogeneous for the entire study area, but varies with respect to a covariate or predictor variable, the distance to a water point in our case. This situation is much more realistic than the previous one. We can see what is the total number of individuals in our population, N.</p>
</div>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(sareaNew[])</span></code></pre></div>
<pre><code>## [1] 365</code></pre>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">
<p>Hemos simulado un total de 352 ciervos repartidos por nuestro área de estudio. Este número es el que intentaremos obtener posteriormente cuando ajustemos nuestro modelo. Para comprobar la relación entre la abundancia de ciervos y la distancia al agua, podemos graficar la correlación entre número de individuos en cada celda y la distancia de estas al punto de agua:</p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p>We have simulated a total of 352 deer spread across our study area. This number is the one that we will try to obtain later when we adjust our model. To check the relationship between the abundance of deer and the distance to the water, we can graph the correlation between the number of individuals in each cell and their distance to the water point:</p>
</div>
</div>
<p><br /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dwat.rasterLayer[],sareaNew[], <span class="at">xlab =</span> <span class="st">&quot;distancia al punto de agua&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;nº de ciervos&quot;</span>)</span></code></pre></div>
<p><br /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-1" aria-hidden="true" tabindex="-1"></a>gg.raster.dwat.df <span class="ot">&lt;-</span> cartomisc<span class="sc">::</span><span class="fu">gplot_data</span>(dwat.rasterLayer)</span>
<span id="cb45-2"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-2" aria-hidden="true" tabindex="-1"></a>gg.raster.sareaNew.df <span class="ot">&lt;-</span> cartomisc<span class="sc">::</span><span class="fu">gplot_data</span>(sareaNew)</span>
<span id="cb45-3"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb45-5"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(gg.raster.dwat.df<span class="sc">$</span>value, gg.raster.df<span class="sc">$</span>value), </span>
<span id="cb45-6"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb45-8"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb45-9"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()  <span class="sc">+</span></span>
<span id="cb45-10"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;distance to water&quot;</span>,</span>
<span id="cb45-11"><a href="simulation-of-the-study-area-and-sampling-with-covariates.html#cb45-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> <span class="st">&quot;number of deer observed&quot;</span>)</span></code></pre></div>
<p><br /></p>
<div style="display: flex;">
<div class="col" style="width:45%">
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
</div>
</div>
<p><br />
<br />
<br /></p>
<div style="display: flex;">
<div class="col" style="font-style: italic; background-color: #d9d9d9; border-style:solid; width:45%">

</div>
<div class="col">
<p> 
<!-- an empty Div (with a white space), serving as
a column separator --></p>
</div>
<div class="col" style="width:45%">

</div>
</div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="unmarked.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ref.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-simulation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
